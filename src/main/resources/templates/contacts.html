<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Google Contacts</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        input, button {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            background-color: #4285F4;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #357ae8;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }
        th {
            background-color: #4285F4;
            color: white;
        }
        td {
            background-color: white;
        }
        .contact-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .delete {
            background-color: red;
            color: white;
            border: none;
            cursor: pointer;
        }
        .editBtn {
            background-color: #f7bc32;
            color: white;
            border: none;
            cursor: pointer;
        }
        .delete:hover, .editBtn:hover {
            opacity: 0.8;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Your Google Contacts</h1>

    <form id="addContactForm">
        <input type="text" id="name" name="name" placeholder="Enter Name" required>
        <input type="email" id="email" name="email" placeholder="Enter Email" required>
        <input type="text" id="number" name="number" placeholder="Enter Number" required>
        <button type="submit">Add Contact</button>
    </form>

    <!-- Contact Table -->
    <table>
        <thead>
        <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone Number</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody id="contactsList">
        <tr th:each="contact : ${contacts}">
            <td th:text="${contact.name}"></td>
            <td th:text="${contact.email}"></td>
            <td th:text="${contact.number}"></td>
            <td class="contact-actions">
                <button class="editBtn">Edit</button>
                <form action="/deleteContact" method="post">
                    <input type="hidden" name="contactId" th:value="${contact.id}">
                    <button type="submit" class="delete">Delete</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<script>
    // Delete confirmation
    document.querySelectorAll('.delete').forEach(button => {
        button.addEventListener('click', function(event) {
            event.preventDefault();
            const isConfirmed = window.confirm('Are you sure you want to delete this contact?');
            if (isConfirmed) {
                const form = this.closest('form');
                form.submit();
            }
        });
    });

    // Add new contact functionality
    document.getElementById('addContactForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const number = document.getElementById('number').value;
        fetch('/addContact', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, email, number })
        })
        .then(response => response.json())
        .then(data => location.reload())
        .catch(error => location.reload());
    });

    // Edit functionality
    document.querySelectorAll('.editBtn').forEach(button => {
        button.addEventListener('click', function() {
            const contactRow = this.closest('tr');
            const contactName = contactRow.querySelector('td:nth-child(1)').textContent;
            const contactEmail = contactRow.querySelector('td:nth-child(2)').textContent;
            const contactNumber = contactRow.querySelector('td:nth-child(3)').textContent;

            // Pre-fill the edit form with current data
            const newName = prompt("Edit Name", contactName);
            const newEmail = prompt("Edit Email", contactEmail);
            const newNumber = prompt("Edit Phone Number", contactNumber);

            // Update the table cells
            if (newName && newEmail && newNumber) {
                contactRow.querySelector('td:nth-child(1)').textContent = newName;
                contactRow.querySelector('td:nth-child(2)').textContent = newEmail;
                contactRow.querySelector('td:nth-child(3)').textContent = newNumber;

                // Optionally, send the updated contact data to the backend
                const contactId = contactRow.querySelector('input[name="contactId"]').value;
fetch('/editContact', {  // Correct endpoint for PATCH requests
    method: 'PATCH',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        contactId: contactId,
        newName: newName,
        newEmail: newEmail,
        newNumber: newNumber
    })
})
.then(response => response.json())
.then(data => {
    console.log('Contact updated successfully');
})
.catch(error => {
    console.error('Error updating contact:', error);
});
            }
        });
    });
</script>
</body>
</html>
